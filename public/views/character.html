<!DOCTYPE html>
<html>
<head>
	<title> </title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.6/css/uikit.min.css">
<link rel="stylesheet" type="text/css" href="css/dashboard.css">
<body>

	<!-- modals tags -->
	<div id="modal-full" class="uk-modal-full" uk-modal>
		<div class="uk-modal-dialog">
			<button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
			<div class="uk-grid-collapse uk-child-width-1-2@s uk-flex-middle" uk-grid>
				<div class="uk-background-cover" style="background-image: url('https://cdn.vox-cdn.com/thumbor/vCRiW3ur2caDLCpbqX4biy2fiwI=/0x0:1920x1080/1200x800/filters:focal(605x350:911x656)/cdn.vox-cdn.com/uploads/chorus_image/image/59533881/keepstar.0.jpg');" uk-height-viewport></div>
				<div class="uk-padding-large">
					<h1 class="uk-text-center">ADD TAGS</h1>
					<form>
						<fieldset class="uk-fieldset">	
							<legend class="uk-legend">Tags name</legend>
							<div class="uk-margin">
								<input id="tagname" class="uk-input" type="text" placeholder="Name">
							</div>
							<legend class="uk-legend">Characters</legend>
							<div class="uk-margin">
								<select id="tagfor" class="uk-select">
									<option value="<%= char.db._id %>"><%= char.db.name %></option>
									<% if (char.db.alts != null) { %>
									<% for(var i=0; i<char.db.alts.alts.length; i++) { %>
									<% if (char.db.alts.alts[i].id != char.db.id) { %>
									<option value="<%= char.db.alts.alts[i]._id %>"><%= char.db.alts.alts[i].name %></option>
									<% } %>
									<% } %>
									<% } %>
								</select>
							</div>
							<legend class="uk-legend">Visibility</legend>
							<div class="uk-margin">
								<select id="tagvisi" class="uk-select">
									<option value="1">Public</option>
									<option value="2">Private</option>
									<option value="3">Secret</option>
									<option value="4">Top Secret</option>
									<option value="5">Extremely Secret</option>
								</select>
							</div>
						</fieldset>
					</form>
					<a class="uk-button uk-button-default uk-width-1-1" onclick="addTag();">Submit</a>
					<div id="errortag" class="uk-alert-danger" style="display: none;" uk-alert>
						<a class="uk-alert-close" uk-close></a>
						<p>Damn, it's a bug. quickly contact the administrator</p>
					</div>
					<div id="missingtag" class="uk-alert-warning" style="display: none;" uk-alert>
						<a class="uk-alert-close" uk-close></a>
						<p>hey dude, fill the fields</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end -->

	<header id="top-head" class="uk-position-fixed">
		<div class="uk-container uk-container-expand uk-background-secondary">
			<nav class="uk-navbar uk-light" data-uk-navbar="mode:click">
				<div class="uk-navbar-left">
					<a class="uk-navbar-item uk-logo" href="/">G.DATA</a>
				</div>
				<div class="uk-navbar-right">
					<ul class="uk-navbar-nav">
						<li>
							<a href="#" data-uk-icon="icon:user"><%= user.name %><div style="width: 1em"></div></a>
							<div class="uk-navbar-dropdown uk-navbar-dropdown-bottom-left">
								<ul class="uk-nav uk-navbar-dropdown-nav">
									<li><a href="#"><span data-uk-icon="icon: sign-out"></span> Logout</a></li>
								</ul>
							</div>
						</li>
						<li><a href="#" data-uk-icon="icon: cog">Members access<div style="width: 1em"></div></a></li>
					</ul>
				</div>
			</nav>
		</div>
	</header>

	<aside id="left-col" class="uk-light uk-visible@m">
		<div class="profile-bar">
			<div class="uk-grid uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
				<div class="uk-width-auto"><img src="http://imageserver.eveonline.com/Character/<%= char.db.id %>_512.jpg" alt="" class="uk-border-circle profile-img"></div>
				<div class="uk-width-expand">
					<h4 class="uk-margin-remove-vertical text-light"><%= char.db.name %></h4>
				</div>
			</div>
		</div>

		<div class="bar-content uk-position-relative">
			<ul class="uk-nav-default" data-uk-nav>
				<li class="uk-nav-header">Character</li>
				<li class="uk-parent">
					<span>Sec. Status : <%= char.basic.security_status %></span>
				</li>
				<li class="uk-parent">
					<span>Birthday : <%= char.basic.birthday %></span>
				</li>
				<li class="uk-parent">
					<span>Corporation : 
						<corp id='corpname'>Loading..</corp>
					</span>
				</li>
				<% if (char.basic.alliance_id) { %>
				<li class="uk-parent">
					<span>Alliance : 
						<alli id='alliname'>Loading</alli>
					</span>
				</li>
				<% } %>
				<br>
				<li class="uk-nav-divider"></li>
				<% if (char.db.tags.length != 0) { %>
				<li class="uk-nav-header">TAGS</li>
				<% for(var y=0; y<char.db.tags.length; y++) { %>
				<li class="uk-parent">
					<% if (char.db.tags[y].visibility <= user.role) { -%>
						<span class="uk-label" uk-tooltip="title: <%= char.db.tags[y].from.name %>"><%= char.db.tags[y].name %></span>
					<% } else { -%>
						<span class="uk-label" uk-tooltip="title: Confidential">Confidential</span>
					<% } -%>	
				</li>
				<% } %>
				<% } %>

				<li class="uk-nav-header">LINKS</li>
				<li><a href="https://evewho.com/pilot/<%= char.db.name %>"><span class="uk-margin-small-right" data-uk-icon="icon: info"></span> evewho</a></li>
				<li><a href="https://zkillboard.com/character/<%= char.db.id %>"><span class="uk-margin-small-right" data-uk-icon="icon: bolt"></span> zKillboard</a></li>
			</ul>
		</div>
	</aside>
	<!-- /LEFT BAR -->

	<div id="content" data-uk-height-viewport="expand: true">
		<div class="uk-container uk-container-expand">
			<div class="uk-grid uk-grid-divider uk-grid-medium uk-child-width-1-1 uk-child-width-1-1@l uk-child-width-1-1@xl" data-uk-grid>
				<div class="uk-width-1-1@s uk-width-1-1@l uk-width-1-1@xl">
					<div class="uk-card uk-card-default uk-card-small">
						<div class="uk-card-body">
							<p uk-margin class="uk-text-center">
								<button class="uk-button uk-button-secondary" href="#modal-full" uk-toggle>add a tags</button>
								<button class="uk-button uk-button-primary">link a character</button>
								<button class="uk-button uk-button-danger">new intel</button>
							</p>
						</div>
					</div>
				</div>
			</div>
			<hr class="uk-divider-icon">
			<div class="uk-grid uk-grid-medium
			uk-grid-match"  data-uk-grid>
			<% if (char.db.alts != null) { %>
			<% for(var i=0; i<char.db.alts.alts.length; i++) { %>
			<% if (char.db.alts.alts[i].id != char.db.id) { %>
			<!-- /panel -->
			<div class="uk-width-1-2@s uk-width-1-4@l uk-width-1-4@xl">
				<div class="uk-card uk-card-default">
					<div class="uk-card-header">
						<div class="uk-grid-small uk-flex-middle" uk-grid>
							<div class="uk-width-auto">
								<img class="uk-border-circle" width="60" height="60" src="http://imageserver.eveonline.com/Character/<%= char.db.alts.alts[i].id %>_512.jpg">
							</div>
							<div class="uk-width-expand">
								<h3 class="uk-card-title uk-margin-remove-bottom"><%= char.db.alts.alts[i].name %></h3>
							</div>
						</div>
					</div>
					<div class="uk-card-body">
						<% if (char.db.alts.alts[i].tags.length != 0) { %>
						<% for(var y=0; y<char.db.alts.alts[i].tags.length; y++) { %>
						<% if (char.db.alts.alts[i].visibility <= user.role) { -%>
						<span class="uk-label" uk-tooltip="title: <%=char.db.alts.alts[i].from.name %>"><%= char.db.alts.alts[i].tags[y].name %></span>
						<% } else { %>
						<span class="uk-label" uk-tooltip="title: Confidential">Confidential</span>
						<% } %>
						<% } %>
						<% } else { %>
						<div class="uk-width-expand uk-text-center">
							<h3 class="uk-text-muted">No tags for this charactere</h3>
						</div>
						<% } %>
					</div>
					<div class="uk-card-footer uk-text-center">
						<a href="/character?id=<%= char.db.alts.alts[i].id %>" class="uk-button uk-button-default">Show</a>
					</div>
				</div>
			</div>
			<% } %>
			<% } %>
			<% } else { %>
			<div class="uk-width-expand uk-text-center">
				<h3 class="uk-text-muted">No alts for this charactere</h3>
			</div>
			<% } %>


			<!-- /panel -->


			<div class=" uk-width-2-1@l uk-width-1-1@xl">
				<div class="uk-card uk-card-default uk-card-small uk-card-hover">
					<div class="uk-card-header">
						<div class="uk-grid uk-grid-small">
							<div class="uk-width-auto"><h4 class="uk-margin-remove-bottom">Intel</h4></div>
							<div class="uk-width-expand uk-text-right">
							</div>
						</div>
					</div>
					<div class="uk-card-body">
						<div class="uk-overflow-auto">
							<table class="uk-table uk-table-hover uk-table-divider uk-table-middle">
								<h3 class="uk-text-muted">No intel for this charactere</h3>
								<thead>
									<!-- <tr>

										<th>Name</th>
										<th>Description</th>
										<th>Date</th>
										<th>Action</th>
									</tr> -->
								</thead>
								<tbody>

										<!-- <tr>

											<td>John Doe</td>
											<td>c'est un sale spy</td>
											<td>11/09/18</td>
											<td>
												<a href="#" class="uk-icon-link uk-text-primary" data-uk-icon="link"></a>
												<a href="#" class="uk-icon-link uk-text-danger" data-uk-icon="close"></a>
											</td>
										</tr>
										<tr>
											<td>Larry Boile</td>
											<td>Maecenas sagittis, dolor id posuere finibus, massa nulla luctus mauris</td>
											<td>13/09/18</td>
											<td>
												<a href="#" class="uk-icon-link uk-text-primary" data-uk-icon="link"></a>
												<a href="#" class="uk-icon-link uk-text-danger" data-uk-icon="close"></a>
											</td>
										</tr>
										<tr>
											<td>Susan Lee</td>
											<td>Sagittis, dolor id posuere finibus, massa nulla luctus mauris</td>
											<td>18/09/18</td>
											<td>
												<a href="#" class="uk-icon-link uk-text-primary" data-uk-icon="link"></a>
												<a href="#" class="uk-icon-link uk-text-danger" data-uk-icon="close"></a>
											</td>
										</tr>
										<tr>
											<td>Jerry Thomas</td>
											<td>Maecenas sagittis, dolor id posuere finibus, massa nulla luctus mauris</td>
											<td>21/09/18</td>
											<td>
												<a href="#" class="uk-icon-link uk-text-primary" data-uk-icon="link"></a>
												<a href="#" class="uk-icon-link uk-text-danger" data-uk-icon="close"></a>
											</td>
										</tr> -->
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
			<footer class="uk-section uk-section-small uk-text-center">
				<hr>
				<a href="https://github.com/Dracks977">Created by Dracks</a> | Send me some isk...</span></a>
			</footer>
		</div>
	</div>
	<!-- /CONTENT -->

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.8/js/uikit.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.8/js/uikit-icons.min.js"></script>
<script
src="https://code.jquery.com/jquery-3.3.1.js"
integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
crossorigin="anonymous"></script>
<script type="text/javascript">
	$('document').ready(function() {
		// a enlever breche de securité
		console.log(<%- JSON.stringify(char) %>)
		$.get( "api/corp/" + <%= char.basic.corporation_id%>, function( data ) {
			$( "#corpname" ).html( data.name );
		});
		<% if (char.basic.alliance_id) { %>
			$.get( "api/alliance/" + <%= char.basic.alliance_id%>, function( data ) {
				$( "#alliname" ).html( data.name );
			});
			<% } %>

		});
	function addTag() {
		let tag = {
			name : $('#tagname').val(),
			visibility : $('#tagvisi').val(),
			_id : '<%= user._id%>',
			id : $('#tagfor').val()
		}
		$.post( "/api/tags/add", tag).done( function (data){
			location.reload();
		}) .fail(function(e) {
			if (e.status == 404)
				$("#missingtag").removeAttr("style");
			else
				$("#errortag").removeAttr("style");
		});
	}
</script>
</html>